# Zoltraak Desktop Prototype

Electronベースで、デスクトップランチャー風のUIとAIメール自動転送を試すプロトタイプです。作業ディレクトリの管理、クイックアクションの配置、3D背景ビジュアライザなど、デスクトップ風の挙動をElectron上で再現します。

## 概要

- ヘッダーの「workspace」チップから作業ディレクトリを選択・更新し、ローカルに設定を保存
- ドラッグ可能なクイックアクション（クイック録音、ディレクトリオープン、AIメール監視など）をダブルクリックで実行
- ブランドロゴのダブルクリックで、作業ディレクトリ構造を3D表示する背景ビジュアライザを切り替え
- アクションごとに開く専用フォームで現在の状態を確認
- POP3での受信監視とSMTP転送（AI整形オプション付き）

## 必要環境

- Node.js と npm が導入済みであること

## インストール

```bash
npm install
```

## 起動

```bash
npm start
```

## 基本操作

- ヘッダー右の「workspace」チップをクリックして作業ディレクトリを設定
- アクションを有効化すると専用フォームが開き、閉じると動作を停止
- クイックアクションはドラッグで配置を変え、ダブルクリックで起動（位置はローカルストレージに保存）
- ブランドロゴをダブルクリックすると背景の3DビジュアライザをON/OFF
- 「ディレクトリ」アクションで作業ディレクトリをファイラで開く

## 作業ディレクトリと保存先

- アプリ設定は OS ごとのユーザーデータディレクトリ（Electron `app.getPath('userData')` 配下）に `settings.json` として保存されます  
  - 保存内容: `workspaceDirectory`、AIメール転送先/整形設定、転送済み件数、POP3の既読UID など
- 作業ディレクトリ直下に自動生成されるディレクトリ
  - `Mail/Received/`: POP3で取得した生メール（.eml, POP3ヘッダー除去済み）
  - `Mail/Send/`: 転送したメールのコピー（.eml）
  - `Mail/Prompt/default.txt`: AI整形用の既定プロンプト（未存在なら初回起動時に作成）
  - `Recording/`: クイック録音の保存先

## クイック録音

- クイックアクション「クイック録音」をダブルクリックすると録音開始、カード上の「停止」で終了
- 録音中はカード上にRECと経過時間が表示され、終了後に自動保存されます
- ファイル名: `recording_YYYYMMDD_HHMMSS.ext`（MIMEタイプに応じて `webm` / `wav` / `ogg`）
- 保存先: 作業ディレクトリ直下の `Recording/`
- マイク利用の許可が必要です。保存中は再録音できないため完了を待ってください

## AIメール監視（POP3→SMTP + AI整形）

- クイックアクション「AIメール監視」をダブルクリックするとパネルが開きます
  1. 「転送先を設定」で転送先メールアドレスを登録（未設定だと監視は開始しません）
  2. 必要に応じて「AI整形設定」を開き、プロバイダ・APIキー・プロンプトを編集
  3. 「監視を開始」でPOP3を監視し、1分ごとに新着を転送（パネル開閉とは独立して動作）
- 受信/送信の複写: 受信メールは `Mail/Received/` に、転送したメールは `Mail/Send/` に `.eml` で保存
- デフォルト接続設定（詳細は `docs/ai-mail.md` 参照）
  - POP3: `wx105.wadax-sv.jp:995` (TLS) / ユーザー `ai-mail@shoeidenko.co.jp` / パスワード `s33sswyfh!`
  - SMTP: `wx105.wadax-sv.jp:587` (STARTTLS)
- AI整形
  - OpenRouter か LM Studio を選択可能（APIキー/モデル名/エンドポイントをUIから指定）
  - タイムアウトは OpenRouter 30秒以上、LM Studio 60秒以上を推奨（最大180秒）
  - 整形プロンプトは JSONで `{"subject":"","body":""}` を返す想定。空欄時は `Mail/Prompt/default.txt` の内容を使用し、UIから既定値の読み込み・上書きができます
  - 整形に失敗した場合は原文の件名/本文で転送し、パネルにエラーが表示されます
- 付属の「状態更新」「手動取得」はそれぞれ最新ステータスの反映と単発取得（監視停止中も実行可）を行います

## 背景ビジュアライザ

- ブランドロゴのダブルクリックでON/OFFを切り替え
- 作業ディレクトリ内のファイル/ディレクトリを最大180ノード・深さ4で3D表示（`node_modules` や `.git` などは除外）
- three.js を使い、ウィンドウサイズ変更時に自動リサイズされます

## プロジェクト構造

```
zoltraak_os/
├── docs/                 # 付随ドキュメント
├── public/               # レンダラ (UI) 資材
├── src/                  # メイン/プリロード/AIメール処理
├── package.json
└── README.md
```

## 開発メモ

- **フレームワーク**: Electron
- **言語**: JavaScript (CommonJS)
- **3D描画**: three.js
- **ライセンス**: ISC
